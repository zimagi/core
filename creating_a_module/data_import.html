
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Defining data importation &mdash; Zimagi 0.14.2
 documentation</title>
    
    
    
    
    
      <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
        
        
          <script type="text/javascript"
                  id="documentation_options"
                  data-url_root="../"
                  src="../_static/documentation_options.js"></script><script src="../_static/jquery.js?v=5d32c60e"></script><script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script><script src="../_static/documentation_options.js?v=0dc20415"></script><script src="../_static/doctools.js?v=9bcbadda"></script><script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
          
          <script type="text/javascript" src="../_static/js/theme.js"></script>
          
      
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
          <link rel="stylesheet" href="../_static/css/override.css" type="text/css" /><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Defining commands" href="commands.html" /><link rel="prev" title="Defining a data model" href="data_model.html" />
    </head>
    <body class="wy-body-for-nav">
      
      <div class="wy-grid-for-nav">
        
        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
          <div class="wy-side-scroll">
            <div class="wy-side-nav-search"
                 style="background: #021026">
              
              
                
                  <a href="../readme.html" class="icon icon-home"><span class="name">Zimagi</span>
                
              </a>
              <span class="description">Distributed Data Processing Platform
                
              </span>
              
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
            
          </div>
          
            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
              
                
                
                  
                
                
                  <p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://zimagi.com">Zimagi Site</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/zimagi/zimagi/">GitHub Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/why.html">What Need Does Zimagi Fulfill?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/why.html#unify-data-sources">Unify data sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/why.html#normalization-of-relations-among-data-entities">Normalization of relations among data entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/why.html#flexible-and-universal-service-hosting">Flexible and universal service hosting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/why.html#both-schedulable-and-user-launchable-actions">Both schedulable and user launchable actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/why.html#types-of-zimagi-users">Types of Zimagi users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/why.html#zimagi-versus-luigi-airflow-and-jenkins">Zimagi versus Luigi, Airflow, and Jenkins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview/why.html#a-tabular-comparison-of-what-zimagi-is-and-is-not">A Tabular Comparison of what Zimagi is and is not</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/readme.html">Getting Started with Zimagi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/about.html">About Zimagi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/components.html">Components of Zimagi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#databases">Databases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#execution-environment">Execution Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#specifications">Specifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../concepts/components.html#command-specifications">Command specifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#data-specifications">Data Specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#plugin-specifications">Plugin Specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#plugins">Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#parsers">Parsers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#modules">Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/components.html#putting-it-all-together">Putting It All Together</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/use_module.html">Using Zimagi Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/use_module.html#installing-zimagi">Installing Zimagi</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/use_module.html#cloning-the-zimagi-repo">Cloning the Zimagi Repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/use_module.html#configuring-the-environment">Configuring the environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/commands.html">The Command Line Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#config-commands">Config Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#environment-commands">Environment Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#database-commands">Database Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#schedule-commands">Schedule Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#data-import-commands">Data Import Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#user">User</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/vagrant.html">Launching Vagrant containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/vagrant.html#when-things-go-wrong">When things go wrong</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/vagrant.html#dependencies">Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/vagrant.html#ports">Ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/vagrant.html#recovery">Recovery</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../overview/contributing.html">Contributing to Zimagi</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developing a Zimagi Module</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create_module.html">Creating a module</a></li>
<li class="toctree-l2"><a class="reference internal" href="initializing.html">Initializing Zimagi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="initializing.html#creating-a-module-skeleton">Creating a module skeleton</a></li>
<li class="toctree-l3"><a class="reference internal" href="initializing.html#adding-a-module-to-zimagi">Adding a module to Zimagi</a></li>
<li class="toctree-l3"><a class="reference internal" href="initializing.html#creating-a-local-remote">Creating a local remote</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="module_functionality.html">Developing module functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="module_functionality.html#defining-roles">Defining roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="module_functionality.html#data-mixins">Data mixins</a></li>
<li class="toctree-l3"><a class="reference internal" href="module_functionality.html#command-mixins">Command mixins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data_model.html">Defining a data model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="data_model.html#defining-data-base-objects">Defining data_base objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_model.html#defining-data-objects">Defining data objects</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Defining data importation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#python-import-code">Python import code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-items">Loading items</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="commands.html">Defining commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="commands.html#import-commands">Import commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_line_comparison.html">Comparison of <code class="docutils literal notranslate"><span class="pre">noaa-stations</span></code> with <code class="docutils literal notranslate"><span class="pre">module-noaa-stations</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line_comparison.html#code-required">Code required</a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_comparison.html#feature-comparisons">Feature comparisons</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/design_architecture/readme.html">Zimagi Design and Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/concepts.html">Zimagi Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/technologies.html">Zimagi Technologies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/systems.html">Zimagi Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/interface.html">Zimagi Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/services/readme.html">Zimagi Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/services/cli.html">Zimagi Command Line Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/services/command.html">Zimagi Command API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/services/data.html">Zimagi Data API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/services/scheduler.html">Zimagi Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/services/worker.html">Zimagi Worker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/data/readme.html">Zimagi Data Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/environment.html">Zimagi Environment Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/host.html">Zimagi Environment Host Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/user.html">Zimagi User Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/group.html">Zimagi Group Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/log.html">Zimagi Log Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/module.html">Zimagi Module Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/state.html">Zimagi State Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/configuration.html">Zimagi Configuration Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/schedule.html">Zimagi Schedule Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/data/notification.html">Zimagi Notification Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/plugins/readme.html">Zimagi Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/plugins/module.html">Zimagi Module Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/plugins/task.html">Zimagi Task Plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/commands/readme.html">Zimagi Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/commands/help.html">Zimagi Help Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/commands/environment.html">Zimagi Environment and Connection Management Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/commands/service.html">Zimagi Service Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/commands/data.html">Zimagi Data Management Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/commands/orchestration.html">Zimagi Orchestration and Workflow Commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/orchestration/readme.html">Zimagi Orchestration Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/orchestration/config.html">Zimagi Configuration Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/orchestration/group.html">Zimagi Group Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/orchestration/run.html">Zimagi Run Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/orchestration/destroy.html">Zimagi Destroy Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../concepts/design_architecture/orchestration/profile.html">Zimagi Profile Component</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/design_architecture/extending.html">Extending Zimagi</a></li>
</ul>
</li>
</ul>

                
              
            </div>
          
        </div>
      </nav>
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
            <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
            <a href="../readme.html"><span>Zimagi</span> - <span class="description">Distributed Data Processing Platform</span></a>
          
        </nav>
        <div class="wy-nav-content">
            
              <div class="rst-content style-external-links">
              
                

  


  




<div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li>
        <a href="../readme.html">Docs</a> &raquo;
      </li>
      
        <li>
          <a href="index.html">Developing a Zimagi Module</a> &raquo;
        </li>
      
      <li>Defining data importation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/creating_a_module/data_import.rst.txt" rel="nofollow">View page source</a>
          
        
      </li>
    
  </ul>
  
  <hr />
</div>
                <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                    <div itemprop="articleBody">
                      
  <section id="defining-data-importation">
<h1>Defining data importation<a class="headerlink" href="#defining-data-importation" title="Link to this heading"></a></h1>
<p>To perform import of data within Zimagi, we will also have to define commands
within the YAML configuration files, but it is worth looking at the Python code
needed to do the concrete data acquisition first.</p>
<p>The means by which we do this is defined in the code
<code class="docutils literal notranslate"><span class="pre">$ZDIR/lib/default/modules/noaa-stations/plugins/source/noaa_stations.py</span></code>.
This name (minus the <code class="docutils literal notranslate"><span class="pre">.py</span></code> part) is indicated in the file
<code class="docutils literal notranslate"><span class="pre">$ZDIR/lib/default/modules/noaa-stations/spec/plugins/source.yml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugin</span><span class="p">:</span>
  <span class="n">source</span><span class="p">:</span>
    <span class="c1"># Identify providers across modules</span>
    <span class="n">providers</span><span class="p">:</span>
      <span class="n">noaa_stations</span><span class="p">:</span>
        <span class="n">requirement</span><span class="p">:</span>
          <span class="n">min_year</span><span class="p">:</span>
            <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
            <span class="n">help</span><span class="p">:</span> <span class="n">The</span> <span class="n">beginning</span> <span class="n">year</span> <span class="n">to</span> <span class="n">query</span>
          <span class="n">max_year</span><span class="p">:</span>
            <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
            <span class="n">help</span><span class="p">:</span> <span class="n">The</span> <span class="n">end</span> <span class="n">year</span> <span class="n">to</span> <span class="n">query</span>
        <span class="n">option</span><span class="p">:</span>
          <span class="n">station_ids</span><span class="p">:</span>
            <span class="nb">type</span><span class="p">:</span> <span class="nb">list</span>
            <span class="n">help</span><span class="p">:</span> <span class="n">A</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">station</span> <span class="n">IDs</span> <span class="n">to</span> <span class="n">include</span>
            <span class="n">default</span><span class="p">:</span> <span class="n">null</span>
</pre></div>
</div>
<p>Within this configuration, beyond indicating what Python file to incorporate,
we define required and optional fields to make available to that Python code.
In this example, the Python code will <em>always</em> have access to integer values for
<code class="docutils literal notranslate"><span class="pre">min_year</span></code> and <code class="docutils literal notranslate"><span class="pre">max_year</span></code> and <em>might</em> have access to a list value named
<code class="docutils literal notranslate"><span class="pre">station_ids</span></code>.  Field names must be spelled as valid Python identifiers.</p>
<p>While some Python code is needed here, it mostly follows a fairly strictly
stereotyped pattern.  Obviously, the code needed will vary based on the data
format of the source and any authentication system that might be required to
access it.  For this module example, we chose data that is publicly available
and is contained in a fairly straightforward CSV format.</p>
<p>The bulk of this importer is a class called <code class="docutils literal notranslate"><span class="pre">Provider</span></code> that needs to define
two methods, <code class="docutils literal notranslate"><span class="pre">.load_items()</span></code>, and <code class="docutils literal notranslate"><span class="pre">.load_item()</span></code>.
Exactly what other Python libraries you might use are very specific to the
nature of the data source.  The Zimagi runtime environment <strong>will</strong> make
available <em>Pandas</em> and <em>requests</em>, which are certainly two of those that you
will use very often.</p>
<p>If you need to utilize other libraries, such as database adapters or data format
readers you will need to add them to the Zimagi runtime by <strong>[TODO]</strong>.</p>
<section id="python-import-code">
<h2>Python import code<a class="headerlink" href="#python-import-code" title="Link to this heading"></a></h2>
<p>Let us look at <code class="docutils literal notranslate"><span class="pre">noaa_stations.py</span></code> in a few steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># filename matches name given in plugins data definition</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">systems.plugins.index</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseProvider</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Provider</span><span class="p">(</span><span class="n">BaseProvider</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;noaa_stations&quot;</span><span class="p">)):</span>
          <span class="c1"># Generate a parent class based on &#39;source&#39; and plugin definition</span>
          <span class="c1"># Three interface methods required: item_columns, load_items, load_item</span>
</pre></div>
</div>
<p>We do not have to use <em>requests</em>, <em>pandas</em>, <em>logging</em>, or <em>io</em>, but they are
particular modules that are useful in the methods below.  All we really need is
to define the class <code class="docutils literal notranslate"><span class="pre">Provider</span></code> which has a funny dynamic parent class defined
by passing names to the system class <code class="docutils literal notranslate"><span class="pre">BaseProvider</span></code>.  You need not think about
the metaclass magic underneath this, just copy the pattern.  Always include
“source” and the name you defined in <code class="docutils literal notranslate"><span class="pre">source.yml</span></code> as strings passed to
<code class="docutils literal notranslate"><span class="pre">BaseProvider</span></code>.</p>
<p>Now let us look at the methods we need:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">item_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Return a list of header column names for source dataframe</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;station_id&quot;</span><span class="p">,</span> <span class="s2">&quot;station_name&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
            <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature_attrs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;elevation&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This one is very simple.  All it does is return a list of string names for
fields, as we wish to spell them within Zimagi command line or API access.
Continuing, let us look at the simpler <code class="docutils literal notranslate"><span class="pre">load_item()</span></code> method next:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># Dataframe iterrows passes tuple of (index, object)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Return values list that maps to header elements in item_columns()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">STATION</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">TEMP</span> <span class="o">==</span> <span class="mf">9999.9</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">TEMP</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">TEMP_ATTRIBUTES</span><span class="p">,</span>
            <span class="n">row</span><span class="o">.</span><span class="n">LATITUDE</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">LONGITUDE</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">ELEVATION</span><span class="p">]</span>
</pre></div>
</div>
<p>The task of this method is to take a single <code class="docutils literal notranslate"><span class="pre">row</span></code> object and return a list of
values.  The <code class="docutils literal notranslate"><span class="pre">row</span></code> object can be anything whatsoever, as long as it lets us
figure out a collection of values to match up with the column names returned by
<code class="docutils literal notranslate"><span class="pre">item_columns</span></code>.  In this specific example, the object received is a tuple
containing an index and a Pandas Series (as we will see).  The index into the
underlying Pandas DataFrame is irrelevant to us, but the Series has everything
we care about.</p>
<p>To return a Python list of values, we mostly just access each record in the
Series, which at this point have names corresponding to the column names in the
source CSV files.  You can see that those are spelled a bit differently than
the names we prefer to use in our module (if nothing else, we do not want the
names in ALLCAPS), but the translation is obvious enough from their spelling.</p>
<p>We can also, of course, line up the index positions of the column names we used
with the items returned by the method.  In one case, we do some minor data
cleanup by marking the “missing data” sentinel of 9999.9 as explicitly None
(i.e. the Python <code class="docutils literal notranslate"><span class="pre">None</span></code>, which gets represented as <code class="docutils literal notranslate"><span class="pre">NULL</span></code> in the RDBMS). In
concept though, we could do whatever other calculation or substitution we wished
to within this method.</p>
</section>
<section id="loading-items">
<h2>Loading items<a class="headerlink" href="#loading-items" title="Link to this heading"></a></h2>
<p>The heavy lifting of this data import <code class="docutils literal notranslate"><span class="pre">Provider</span></code> class is performed in the
method <code class="docutils literal notranslate"><span class="pre">.load_items()</span></code>.  Of course, being Python code, we are free to define
whatever other methods might be useful to us within this class, as long as they
do not use these few reserved names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://www.ncei.noaa.gov/data/global-summary-of-the-day/access&quot;</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_min_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_max_year</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">year_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_station_ids</span><span class="p">:</span>
            <span class="c1"># Want all files for this year</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Only pull the list of station_ids given</span>
            <span class="k">for</span> <span class="n">station_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_station_ids</span><span class="p">:</span>
                <span class="n">station_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2">.csv&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching data from </span><span class="si">{</span><span class="n">station_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">station_url</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pulled </span><span class="si">{</span><span class="n">station_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
                    <span class="k">yield from</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Station </span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2"> not present for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementation shown here is partial.  It only accepts the case where
station IDs are explicitly provided.  We have yet to implement the common case
where we load “all stations matching the years given.”  To do that, we will have
to program a little bit of web scraping to read the directory at the base URL
and figure out which CSV files exist.</p>
<p>Bracketing the part not fleshed out, we see everything that is functionally
needed in the <code class="docutils literal notranslate"><span class="pre">else:</span></code> block.  We start at a base URL which we know, by
examination and by the documentation of the data source, contains subdirectories
named after years.  Moreover, we have indicated, in the <code class="docutils literal notranslate"><span class="pre">source.yml</span></code> file
discussed above, that the fields named <code class="docutils literal notranslate"><span class="pre">min_year</span></code> and <code class="docutils literal notranslate"><span class="pre">max_year</span></code> are
required to be present, and to be integers.  To use them within the Python code,
we prefix their names with <code class="docutils literal notranslate"><span class="pre">field_</span></code>.</p>
<p>This code loops over years matching the range defined by the fields, then uses
the <em>requests</em> module to determine whether a corresponding CSV URL exists. We
also log the status of what was done, which is useful but not required.</p>
<p>The essential operation of the <code class="docutils literal notranslate"><span class="pre">.load_items()</span></code> method is that it yields each
individual <code class="docutils literal notranslate"><span class="pre">row</span></code> object of the sort that <code class="docutils literal notranslate"><span class="pre">.load_item()</span></code> will consume.  That
concludes the Python code needed for this module.  What remains is entirely to
configure commands that the Zimagi runtime will use to utilize this Python code
(once combined with base scaffolding code behind the scenes).</p>
</section>
</section>


                    </div>
                    
                  </div>
                <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data_model.html" class="btn btn-neutral float-left" title="Defining a data model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="commands.html" class="btn btn-neutral float-right" title="Defining commands" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Zimagi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
              </div>
          </div>
        </section>
      </div>
      
      <script type="text/javascript">
          jQuery(function() {
              SphinxRtdTheme.Navigation.enable({
                  {
                      'true'
                      if theme_sticky_navigation | tobool
                      else 'false'
                  }
              });
          });
      </script>
      
      
        
      
    </body>
  </html>